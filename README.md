
# Предсказание стоимости автомобилей (Car Price Prediction)



##  Что было сделано

Работа была разделена на несколько этапов:

### 1. Разведочный анализ данных (EDA)
*   **Очистка данных:** Обработаны столбцы `mileage`, `engine`, `max_power`. Удалены единицы измерения (`kmpl`, `cc`, `bhp`), типы приведены к `float`.
*   **Работа с пропусками и дубликатами:** Найдены и удалены полные дубликаты. Пропуски в числовых признаках заполнены медианными значениями (чтобы избежать влияния выбросов).
*   **Парсинг:** Из столбца `torque` извлечены крутящий момент (Nm) и обороты (RPM). Из столбца `name` выделен бренд автомобиля.
*   **Визуализация:** Построены `pairplot`, `heatmap` корреляций (Пирсон, Спирмен, Phik). Выявлено, что цена сильно зависит от года выпуска и мощности, а также имеет логнормальное распределение.

### 2. Построение моделей (Machine Learning)
Были проведены эксперименты с различными моделями линейной регрессии:
1.  **Базовая модель (только числовые признаки):** `LinearRegression`.
2.  **Модели с регуляризацией:** `Lasso` (L1) и `ElasticNet`. Подбор гиперпараметров через `GridSearchCV`.
3.  **Экспериментальная L0-регуляризация:** Реализован жадный алгоритм отбора признаков (Brute Force).
4.  **Модель с категориальными признаками:** Добавлены `fuel`, `seller_type`, `transmission`, `owner`, `brand`/`name` с использованием `OneHotEncoder`.
5.  **Ridge регрессия:** 
6.  **Feature Engineering (Финальная модель):** Применено логарифмирование целевой переменной (`selling_price`) и признака `km_driven`, так как  распределения были скошены.

### 3. Бизнес-метрики
*   Реализована метрика **доли прогнозов с ошибкой <10%**.
*   Реализована кастомная **асимметричная метрика**, штрафующая за недопрогноз (underprediction) сильнее, чем за перепрогноз.

---

## Результаты и Интерпретация

Ниже приведено сравнение качества моделей на тестовой выборке (метрика $R^2$):

| Модель | $R^2$ Score | Комментарий |
| :--- | :---: | :--- |
| Linear Regression (только числа) | ~0.59 | Слабый результат, недостаточно данных. |
| Lasso / ElasticNet (GridSearch) | ~0.59 | Регуляризация почти не помогла, проблема в нехватке признаков. |
| Linear Regression (+ OHE категорий) | ~0.78 | Значительный прирост за счет `brand` и `transmission`. |
| Ridge (+ OHE) | ~0.78 | Аналогично обычной регрессии c категориями. |
| **Final Model (Log-Target + OHE)** | **0.9166** | **Лучший результат.** |


## Что дало наибольший прирост

1.  **Добавление категориальных признаков:** Включение бренда и типа трансмиссии через OneHotEncoding дало скачок $R^2$ с ~0.60 до ~0.78.
2.  **Логарифмирование таргета и признаков:** Это стало решающим фактором. Преобразование `np.log1p` для цены и пробега позволило линейной модели работать с данными, распределенными ненормально, что подняло $R^2$ до **0.92**.

---

## Что не удалось / Выводы из неудач

*   **L0-регуляризация:** Самописный перебор признаков оказался вычислительно затратным и не дал прироста качества. Метрики AIC/BIC ухудшались при удалении признаков, что говорит о важности всех имеющихся данных для линейной модели.
*   **Предсказание с точностью 10%:** Бизнес-метрика (доля попаданий в 10%-ю окрестность цены) осталась невысокой даже у лучшей модели. Это говорит о том, что линейная регрессия не может уловить все нюансы ценообразования б/у авто, либо данных недостаточно.
* Не удалось улучшить качество ещё больше и изучить данные подробнее из-за кучи дедлайнов :(
---

## Оценка сервиса (Streamlit App)

Приложение доступно по ссылке: https://carprediction-vmhnwvlhdcuzytqn8iusiy.streamlit.app/

### Функционал:
1.  **Dashboard EDA:** Интерактивные графики распределений и зависимостей (Plotly), матрицы корреляций (включая Phik).
2.  **ML Inference:** Возможность ввести параметры одного автомобиля вручную или загрузить CSV-файл для пакетной обработки.
3.  **Feature Importance:** Визуализация весов линейной модели для интерпретируемости.

### Оценка:
*   **Удобство:** Приложение интуитивно понятно, разделено на вкладки.
*   **Визуализация:** Графики Plotly интерактивны и информативны. Особенно полезен график корреляции Phik для смешанных типов данных.


